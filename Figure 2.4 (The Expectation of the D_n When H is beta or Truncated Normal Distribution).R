
###############               H=beta distribution

############ Function of moments M_i,j

M = function(a,b,i,j){
  (gamma(a+i)*gamma(b+j)*gamma(a+b))/(gamma(a)*gamma(b)*gamma(a+b+i+j))
}
############# Function of Combination
comb = function(n, x) {
  factorial(n) /(factorial(n-x)*factorial(x))
}
############# Function of Rodriguez and Dunson 2014 (RD) 
RD = function(a,b,k){k*M(a,b,1,k-1) /(1-M(a,b,0,k))}

############# Function of ASK
ASK = function(a,b,k){M(a,b,k,0) /(1-M(a,b,0,k))}
####################
r <-50
a<-5
b<-10
En_ASK<-numeric(r)
En_RD<-numeric(r)
Dn_ASK<-numeric(r)
Dn_RD<-numeric(r)
for (i in 1:r){
  En_ASK<-En_ASK*0
  En_RD<-En_RD*0
  for (j in 1:i){
    En_ASK[j]<-((-1)^(j+1))*comb(i,j)*ASK(a,b,j)
    En_RD[j]<-RD(a,b,j)
  }
  Dn_ASK[i]<-sum(En_ASK)
  Dn_RD[i]<-sum(En_RD)
}
sum(En_ASK)
sum(En_RD)
Dn_ASK
Dn_RD 

################################################################
################################################################
################################################################
################################################################
################################################################


n <- 5000
nn<-500000
r<-50
mean1<-numeric(r)
a1<-5
b1<-10

for (i in 1:nn){
  G_0 <- function(n) rnorm(n, 0, 1)
  y <- G_0(n)
  rb1 <- rbeta(n,a1,b1)
  p1 <- numeric(n)
  p1[1] <- rb1[1]
  p1[2:n] <- sapply(2:n, function(i) rb1[i] * prod(1 - rb1[1:(i-1)]))
  G1 <- sample(y, prob = p1, replace = TRUE)
  BTPP1<-c(1:n)*0
  m1<-c(1:n)*0
  k1=1
  BTPP1[1]<-k1
  m1[1]<-k1
  for (ii in 2:r){
    
    for (j in 1:(ii-1)){
      if(G1[ii]==G1[j]){BTPP1[ii]<-BTPP1[j]
      m1[ii]<-m1[ii-1]}
    }
    
    if(BTPP1[ii]==0){k1<-k1+1
    BTPP1[ii]<-k1
    m1[ii]<-m1[ii-1]+1}
    
  }
  mean1<-mean1+m1[1:r]
  
}

mean1<-mean1/nn
mean1
#######################################
#######################################
a1<-5
b1<-10
Dn_ASK1<-c(1.000000, 1.769231, 2.383779, 2.889882, 3.317013, 3.684755, 4.006593, 4.292103, 4.548280,
           4.780351, 4.992310, 5.187264, 5.367671, 5.535506, 5.692374, 5.839599, 5.978280, 6.109344,
           6.233576, 6.351646, 6.464131, 6.571533, 6.674288, 6.772781, 6.867348, 6.958289, 7.045872,
           7.130334, 7.211890, 7.290732, 7.367036, 7.440958, 7.512643, 7.582223, 7.649816, 7.715533,
           7.779476, 7.841737, 7.902403, 7.961554, 8.019262, 8.075597, 8.130622, 8.184398, 8.236979,
           8.288417, 8.338761, 8.388057, 8.436346, 8.483670)
Dn_RD1<-c(1.000000, 1.769231, 2.367057, 2.836140, 3.207530, 3.504079, 3.742776, 3.936372, 4.094523,
          4.224601, 4.332282, 4.421968, 4.497100, 4.560386, 4.613971, 4.659567, 4.698547, 4.732018,
          4.760881, 4.785871, 4.807589, 4.826533, 4.843115, 4.857677, 4.870505, 4.881840, 4.891885,
          4.900811, 4.908764, 4.915867, 4.922227, 4.927935, 4.933069, 4.937697, 4.941877, 4.945660,
          4.949090, 4.952207, 4.955043, 4.957628, 4.959989, 4.962148, 4.964126, 4.965941, 4.967608,
          4.969141, 4.970554, 4.971857, 4.973060, 4.974173)
mean1<-c(1.000000, 1.769880, 2.384554, 2.890464, 3.317476, 3.683398, 4.005178, 4.290564, 4.546488,
         4.779054, 4.990194, 5.185336, 5.366432, 5.533884, 5.691498, 5.838366, 5.977016, 6.108030,
         6.231412, 6.349124, 6.461134, 6.568358, 6.671556, 6.770134, 6.864918, 6.955582, 7.043352,
         7.127464, 7.210266, 7.289024, 7.365080, 7.439208, 7.510242, 7.579908, 7.647398, 7.713022,
         7.777540, 7.840002, 7.900140, 7.959004, 8.016724, 8.072908, 8.127858, 8.181784, 8.234072,
         8.285518, 8.335964, 8.385402, 8.434122, 8.481432)

Dn_ASK
Dn_RD
mean1
###########################################################################
###########################################################################
###########################################################################


###############               H=truncated normal distribution

############# Function of Combination
comb = function(n, x) {
  factorial(n) /(factorial(n-x)*factorial(x))
}
####################
n<-50000000
library(truncnorm)
m<-0.2
s<-0.2
x <- rtruncnorm(n,0,1,m,s)
ASK<-numeric(50)
RD<-numeric(50)
for (i in 1:50){
  ASK[i]<- mean(x^i)/(1-mean((1-x)^i))
  RD[i]<-mean(x*((1-x)^(i-1)))/(1-mean((1-x)^i))
}
En_ASK<-numeric(50)
En_RD<-numeric(50)
Dn_ASK<-numeric(50)
Dn_RD<-numeric(50)
for (i in 1:50){
  En_ASK<-En_ASK*0
  En_RD<-En_RD*0     
for (j in 1:i){
  En_ASK[j]<-((-1)^(j+1))*comb(i,j)*ASK[j]
  En_RD[j]<-j*RD[j]
}
Dn_ASK[i]<-sum(En_ASK)
Dn_RD[i]<-sum(En_RD)

}
sum(En_ASK)
sum(En_RD)
Dn_ASK
Dn_RD

4*50*(mean(1-x))^(4999)
################################################################
################################################################
################################################################
################################################################
################################################################


n <- 5000
nn<-500000
r<-50
mean<-numeric(r)

for (i in 1:nn){
  G_0 <- function(n) rnorm(n, 0, 1)
  y <- G_0(n)
  library(truncnorm)
  rTN <- rtruncnorm(n,0,1,m,s)
  p1 <- numeric(n)
  p1[1] <- rTN[1]
  p1[2:n] <- sapply(2:n, function(i) rTN[i] * prod(1 - rTN[1:(i-1)]))
  G1 <- sample(y, prob = p1, replace = TRUE)
  TN<-c(1:n)*0
  m1<-c(1:n)*0
  k1=1
  TN[1]<-k1
  m1[1]<-k1
  for (ii in 2:r){
    
    for (j in 1:(ii-1)){
      if(G1[ii]==G1[j]){TN[ii]<-TN[j]
      m1[ii]<-m1[ii-1]}
    }
    
    if(TN[ii]==0){k1<-k1+1
    TN[ii]<-k1
    m1[ii]<-m1[ii-1]+1}
    
  }
  mean1<-mean1+m1[1:r]
  
}

mean1<-mean1/nn
mean1



sum(mean1-Dn_ASK)
0.2373109
sum(mean1-Dn_RD)
53.03405

mean2<-c(1.000002,  1.902444,  2.722791,  3.472821,  4.162414,  4.797904,  5.388877,  5.940884,
6.456091,  6.940480,  7.396765,  7.827776,  8.236771,  8.624701,  8.993420,  9.345319,
9.680251, 10.000718, 10.308229, 10.604455, 10.888116, 11.162334, 11.426499, 11.681477,
11.927784, 12.164688, 12.394351, 12.618083, 12.834894, 13.045606, 13.249756, 13.447751,
13.639679, 13.828174, 14.011324, 14.190692, 14.365247, 14.536259, 14.701897, 14.864460,
15.023544, 15.179382, 15.331015, 15.479817, 15.625641, 15.768257, 15.908156, 16.045932,
16.180718, 16.313855)

Dn_ASK2<-c(1.000000,  1.902501,  2.722584,  3.472365,  4.161684,  4.798602,  5.389786,  5.940792,
6.456289,  6.940225,  7.395964,  7.826390,  8.233988,  8.620914,  8.989045,  9.340028,
9.675310,  9.996170, 10.303744, 10.599041, 10.882967, 11.156333, 11.419867, 11.674231,
11.920020, 12.157776, 12.387994, 12.611124, 12.827578, 13.037735, 13.241941, 13.440519,
13.633762, 13.821944, 14.005319, 14.184122, 14.358571, 14.528870, 14.695208, 14.857763,
15.016700, 15.172174, 15.324332, 15.473310, 15.619236, 15.762232, 15.902412, 16.039882,
16.174745, 16.307097)

Dn_RD2<-c(1.000000,  1.902501,  2.719855,  3.462629,  4.139885,  4.759411,
5.327918,  5.851201, 6.334280,  6.781509,  7.196682,  7.583107,  7.943681,
8.280945,  8.597133,  8.894217, 9.173940,  9.437848,  9.687314,  9.923562,
10.147685, 10.360661, 10.563369, 10.756597, 10.941059, 11.117396, 11.286191,
11.447971, 11.603217, 11.752365, 11.895814, 12.033927, 12.167039, 12.295456,
12.419458, 12.539305, 12.655235, 12.767467, 12.876207, 12.981641,13.083945,
13.183281, 13.279800, 13.373642, 13.464939, 13.553812, 13.640376, 13.724737,
13.806995, 13.887245)


xx<-1:r

par(mfrow=c(1,2))

plot(xx,Dn_ASK1,type="l",xlab="Samples", 
     ylab="Expectation of distinct values", main="H=beta (5,10)",col="black")
lines(xx,Dn_RD1, col="blue")
lines(xx[5:10],mean1[5:10],col="red")
lines(xx[15:20],mean1[15:20],col="red")
lines(xx[25:30],mean1[25:30],col="red")
lines(xx[35:40],mean1[35:40],col="red")
lines(xx[45:50],mean1[45:50],col="red")


plot(xx,Dn_ASK2,type="l",xlab="Samples", 
     ylab="Expectation of distinct values", main="H=TN (0.1,0.1)",col="black")
lines(xx,Dn_RD2, col="blue")
lines(xx[5:10],mean2[5:10],col="red")
lines(xx[15:20],mean2[15:20],col="red")
lines(xx[25:30],mean2[25:30],col="red")
lines(xx[35:40],mean2[35:40],col="red")
lines(xx[45:50],mean2[45:50],col="red")



